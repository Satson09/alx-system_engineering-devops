#!/usr/bin/env bash

# Update apt package index
sudo apt update

# Install nginx
sudo apt install -y nginx

# Define the redirection configuration
REDIRECTION_CONFIG=$(cat <<EOF
server {
    listen 80;
    server_name _;
    location /redirect_me {
        return 301 https://www.youtube.com/permanent;
    }
}
EOF
)

# Use sed to replace the entire default configuration with the redirection configuration
sudo sed -i '/^server {/,/^}$/d' /etc/nginx/sites-available/default
echo "$REDIRECTION_CONFIG" | sudo tee -a /etc/nginx/sites-available/default >/dev/null

# Test nginx configuration
sudo nginx -t

# Reload nginx to apply the changes
sudo systemctl reload nginx
